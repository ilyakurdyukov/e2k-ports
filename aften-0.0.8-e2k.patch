From f7f7b39ba1ebecaf617bb7aac035cec958fab070 Mon Sep 17 00:00:00 2001
From: Ilya Kurdyukov <jpegqs@gmail.com>
Date: Tue, 8 Jun 2021 17:57:12 +0700
Subject: [PATCH] aften-0.0.8 e2k support

---
 CMakeLists.txt | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index ba6f0f2..445fcc3 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -179,13 +179,15 @@ IF(SVN_VERSION)
 ENDIF(SVN_VERSION)
 
 # do SIMD stuff
-IF(CMAKE_SYSTEM_MACHINE MATCHES "i.86" OR CMAKE_SYSTEM_MACHINE MATCHES "x86_64")
+IF(CMAKE_SYSTEM_MACHINE MATCHES "i.86" OR CMAKE_SYSTEM_MACHINE MATCHES "x86_64" OR CMAKE_SYSTEM_MACHINE MATCHES "e2k")
   CHECK_MMX()
 
   IF(HAVE_MMX)
     INCLUDE_DIRECTORIES(${Aften_SOURCE_DIR}/libaften/x86)
     SET(LIBAFTEN_SRCS ${LIBAFTEN_SRCS} ${LIBAFTEN_X86_SRCS})
-    ADD_DEFINE(HAVE_CPU_CAPS_DETECTION)
+    IF(NOT CMAKE_SYSTEM_MACHINE MATCHES "e2k")
+      ADD_DEFINE(HAVE_CPU_CAPS_DETECTION)
+    ENDIF(NOT CMAKE_SYSTEM_MACHINE MATCHES "e2k")
 
     CHECK_SSE()
     SET(LIBAFTEN_SRCS ${LIBAFTEN_SRCS} ${LIBAFTEN_X86_MMX_SRCS})
@@ -231,7 +233,7 @@ IF(CMAKE_SYSTEM_MACHINE MATCHES "i.86" OR CMAKE_SYSTEM_MACHINE MATCHES "x86_64")
       CHECK_CASTSI128()
     ENDIF(HAVE_SSE3)
   ENDIF(HAVE_MMX)
-ENDIF(CMAKE_SYSTEM_MACHINE MATCHES "i.86" OR CMAKE_SYSTEM_MACHINE MATCHES "x86_64")
+ENDIF(CMAKE_SYSTEM_MACHINE MATCHES "i.86" OR CMAKE_SYSTEM_MACHINE MATCHES "x86_64" OR CMAKE_SYSTEM_MACHINE MATCHES "e2k")
 
 IF(CMAKE_SYSTEM_MACHINE MATCHES "Power Macintosh" OR CMAKE_SYSTEM_MACHINE MATCHES "ppc")
   CHECK_ALTIVEC()
-- 
2.17.1

